# Python SDK v1.17.0 Release Notes

**Release Date**: Based on git history  
**Previous Version**: v1.16.0  
**Repository**: modelcontextprotocol/python-sdk

## Overview

Version 1.17.0 introduces tool removal capabilities, improves OAuth compliance with RFC 9728, and significantly expands documentation. This release includes 6 commits with 608 insertions and 56 deletions across 18 files.

---

## üéØ New Features

### Tool Removal Capability
**PR**: #1322  
**Commit**: `b8e758b`

Added the ability to dynamically remove tools from a running MCP server.

#### API Changes

**FastMCP Class**
```python
def remove_tool(self, name: str) -> None:
    """Remove a tool from the server by name.
    
    Args:
        name: The name of the tool to remove
    
    Raises:
        ToolError: If the tool does not exist
    """
```

**ToolManager Class**
```python
def remove_tool(self, name: str) -> None:
    """Remove a tool by name."""
    if name not in self._tools:
        raise ToolError(f"Unknown tool: {name}")
    del self._tools[name]
```

#### Use Cases
- Dynamic server reconfiguration
- Conditional tool availability based on context
- Runtime tool management in long-running servers

#### Files Modified
- `src/mcp/server/fastmcp/server.py`
- `src/mcp/server/fastmcp/tools/tool_manager.py`
- `tests/server/fastmcp/test_server.py` (new tests)
- `tests/server/fastmcp/test_tool_manager.py` (new tests)

---

## üîê OAuth and Security

### RFC 9728 Compliance for Protected Resource Metadata
**PR**: #1407  
**Commit**: `df3e428`

Improved OAuth protected resource metadata URL construction to properly comply with RFC 9728 (OAuth 2.0 Protected Resource Metadata).

#### Changes

**New Function**: `build_resource_metadata_url()`
```python
def build_resource_metadata_url(resource_server_url: AnyHttpUrl) -> AnyHttpUrl:
    """
    Build RFC 9728 compliant protected resource metadata URL.
    
    Inserts /.well-known/oauth-protected-resource between host and resource path
    as specified in RFC 9728 ¬ß3.1.
    
    Args:
        resource_server_url: The resource server URL (e.g., https://example.com/mcp)
    
    Returns:
        The metadata URL (e.g., https://example.com/.well-known/oauth-protected-resource/mcp)
    """
```

#### Implementation Details

**Before** (v1.16.0):
```python
resource_metadata_url = AnyHttpUrl(
    str(self.settings.auth.resource_server_url).rstrip("/") + "/.well-known/oauth-protected-resource"
)
```

**After** (v1.17.0):
```python
from mcp.server.auth.routes import build_resource_metadata_url
resource_metadata_url = build_resource_metadata_url(self.settings.auth.resource_server_url)
```

#### URL Construction Examples

| Resource Server URL | Metadata URL (v1.16.0) | Metadata URL (v1.17.0) |
|---------------------|------------------------|------------------------|
| `https://example.com/mcp` | `https://example.com/mcp/.well-known/oauth-protected-resource` | `https://example.com/.well-known/oauth-protected-resource/mcp` |
| `https://api.example.com` | `https://api.example.com/.well-known/oauth-protected-resource` | `https://api.example.com/.well-known/oauth-protected-resource` |
| `https://example.com/` | `https://example.com/.well-known/oauth-protected-resource` | `https://example.com/.well-known/oauth-protected-resource` |

#### Route Registration

The `create_protected_resource_routes()` function now:
1. Uses `build_resource_metadata_url()` to construct the compliant URL
2. Extracts the path component for route registration
3. Properly handles resource paths according to RFC 9728 ¬ß3.1

#### Files Modified
- `src/mcp/server/auth/routes.py`
- `src/mcp/server/fastmcp/server.py` (updated to use new function)
- `examples/servers/simple-auth/mcp_simple_auth/server.py`
- `tests/server/auth/test_protected_resource.py` (extensive new tests)

#### Compliance Impact
- **RFC 9728 ¬ß3.1**: Metadata URL construction now follows the specification
- **WWW-Authenticate Header**: Properly includes compliant resource metadata URLs
- **OAuth 2.0 Clients**: Better interoperability with standards-compliant OAuth clients

---

## üìö Documentation

### New Documentation Structure
**PRs**: #1425, #1426, #1430  
**Commits**: `89619a8`, `814c9c0`, `7d335ef`

Significantly expanded documentation with new guides and improved structure.

#### New Files

**`docs/testing.md`** - Complete Testing Guide
- How to test MCP servers
- Using `create_connected_server_and_client_session()`
- Example test fixtures using pytest
- Testing tools with snapshot testing
- Integration with `anyio` and `trio`

Example from the guide:
```python
import pytest
from mcp.server import Server
from mcp.client import ClientSession
from mcp.shared.memory import create_connected_server_and_client_session


@pytest.fixture
async def client_session() -> ClientSession:
    server = Server("test-server")
    
    @server.call_tool()
    async def add(a: int, b: int) -> int:
        """Add two numbers"""
        return a + b
    
    async with create_connected_server_and_client_session(server) as (_, client_session):
        yield client_session


async def test_call_add_tool(client_session: ClientSession):
    result = await client_session.call_tool("add", {"a": 1, "b": 2})
    assert result == snapshot(
        CallToolResult(
            content=[TextContent(type="text", text="3")],
            structuredContent={"result": 3},
        )
    )
```

**`docs/installation.md`** - Installation Guide
- Installation instructions for pip and uv
- Complete dependency list with descriptions
- Optional dependency groups documentation
- Package versions and purposes

Dependencies documented:
- `httpx`, `httpx-sse` - HTTP/SSE transports
- `pydantic` - Types and validation
- `starlette` - Web framework
- `python-multipart` - HTTP body parsing
- `sse-starlette` - Server-Sent Events
- `pydantic-settings` - Settings management
- `uvicorn` - ASGI server
- `jsonschema` - JSON schema validation
- `pywin32` - Windows support

**`docs/concepts.md`** - Core Concepts (Placeholder)
- Framework for future documentation on:
  - Server vs Client architecture
  - Three primitives (tools, resources, prompts)
  - Transports (stdio, SSE, streamable HTTP)
  - Context and sessions
  - Lifecycle and state

#### Updated Documentation

**`docs/index.md`** - Enhanced Homepage
- Added comprehensive overview of MCP
- Quick example showing server with tool, resource, and prompt
- Getting started section with links to guides
- MCP Inspector integration instructions
- Links to specification documentation

Example code:
```python
from mcp.server.fastmcp import FastMCP

mcp = FastMCP("Test Server")

@mcp.tool()
def add(a: int, b: int) -> int:
    """Add two numbers"""
    return a + b

@mcp.resource("greeting://{name}")
def get_greeting(name: str) -> str:
    """Get a personalized greeting"""
    return f"Hello, {name}!"

@mcp.prompt()
def greet_user(name: str, style: str = "friendly") -> str:
    """Generate a greeting prompt"""
    return f"Write a {style} greeting for someone named {name}."
```

**`README.md`**
- Added direct link to Python SDK documentation
- Improved navigation for new users

**`mkdocs.yml`** - Documentation Structure
- Added new pages to navigation
- Improved documentation organization

---

## üõ†Ô∏è Minor Updates

### Project Maintenance
**PR**: #1431  
**Commit**: `61399b3`

- Updated `CLAUDE.md` to remove auto-addition of reviewers
- Minor workflow improvements

---

## üìä Statistics

### Commit Summary
```
89619a8 Add documentation structure (#1425)
814c9c0 Add documentation about testing (#1426)
df3e428 Improve OAuth protected resource metadata URL construction per RFC 9728 (#1407)
b8e758b feat: add ability to remove tools (#1322)
7d335ef Update README to link to Python SDK documentation (#1430)
61399b3 fix: update CLAUDE.md to remove auto-addition of reviewers. (#1431)
```

### Changed Files
```
18 files changed, 608 insertions(+), 56 deletions(-)

Documentation (New):
- docs/testing.md (+78 lines)
- docs/installation.md (+31 lines)
- docs/concepts.md (+13 lines)

Documentation (Updated):
- docs/index.md (+57 lines)
- docs/authorization.md (+5 lines)
- docs/low-level-server.md (+5 lines)
- mkdocs.yml (+8 lines)
- README.md (+10 lines)

Source Code:
- src/mcp/server/fastmcp/server.py (+49 insertions, -56 deletions)
- src/mcp/server/fastmcp/tools/tool_manager.py (+6 lines)
- src/mcp/server/auth/routes.py (+28 lines)
- src/mcp/shared/memory.py (+25 insertions, -56 deletions)

Tests (New):
- tests/server/fastmcp/test_tool_manager.py (+113 lines)

Tests (Updated):
- tests/server/fastmcp/test_server.py (+74 lines)
- tests/server/auth/test_protected_resource.py (+154 lines, -2 deletions)

Examples:
- examples/servers/simple-auth/mcp_simple_auth/server.py (+4 lines, -1 deletion)

Project:
- pyproject.toml (+1 line)
- CLAUDE.md (-2 lines)
```

---

## üîÑ Migration Guide

### For Server Developers

#### Using Tool Removal
```python
from mcp.server.fastmcp import FastMCP

mcp = FastMCP("My Server")

@mcp.tool()
def temporary_tool() -> str:
    return "I might be removed later"

# Later in your code...
mcp.remove_tool("temporary_tool")  # Dynamically remove the tool
```

#### OAuth Metadata URLs
If you're constructing OAuth metadata URLs manually, update to use the new helper:

```python
# Before
from pydantic import AnyHttpUrl
metadata_url = AnyHttpUrl(
    str(resource_server_url).rstrip("/") + "/.well-known/oauth-protected-resource"
)

# After
from mcp.server.auth.routes import build_resource_metadata_url
metadata_url = build_resource_metadata_url(resource_server_url)
```

### For Testing
Refer to the new `docs/testing.md` for comprehensive testing examples using:
- `create_connected_server_and_client_session()`
- pytest fixtures
- Snapshot testing

---

## üîó References

- **MCP Specification**: https://modelcontextprotocol.io
- **RFC 9728**: OAuth 2.0 Protected Resource Metadata
- **Python SDK Documentation**: Check the updated docs/ directory
- **MCP Inspector**: https://github.com/modelcontextprotocol/inspector

---

## üìù Notes for mcp-commons Update

### Key Integration Points

1. **Tool Management**
   - Consider adding tool removal capability to other SDK implementations
   - Standardize error handling for non-existent tools
   - Document dynamic tool management patterns

2. **OAuth Compliance**
   - RFC 9728 URL construction should be standardized across SDKs
   - Update OAuth documentation with correct metadata URL patterns
   - Add compliance tests for OAuth implementations

3. **Documentation Structure**
   - Testing guide patterns can be adapted for other languages
   - Installation documentation template is reusable
   - Quick start examples demonstrate best practices

4. **Testing Patterns**
   - In-memory transport pattern (`create_connected_server_and_client_session`)
   - Snapshot testing for tool results
   - Async testing with anyio/trio

### Recommended Actions for mcp-commons

- [ ] Update OAuth specification examples with RFC 9728-compliant URLs
- [ ] Add tool removal to core MCP capabilities documentation
- [ ] Create testing best practices guide based on Python SDK patterns
- [ ] Standardize documentation structure across SDK implementations
- [ ] Add OAuth compliance checklist for implementers
- [ ] Document dynamic tool management use cases

---

**Generated**: 2025-01-15  
**Based on**: git diff and log analysis of v1.16.0..v1.17.0  
**For**: mcp-commons update reference
